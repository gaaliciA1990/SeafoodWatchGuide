@page
@using ContosoCrafts.WebSite.Components
@using ContosoCrafts.WebSite.Models;
@using ContosoCrafts.WebSite.Data
@model UpdateModel
@{
    ViewData["Title"] = "Update";
}

<h1>Update</h1>

<!--
    This is the Update page to view the details of a selected record from the Read page. Here the user will find values
    that they are allowed to update. Static values from creation that are expected to not be modified by users are
    read only.
-->

@using (Html.BeginForm())
{
    <div asp-validation-summary="ModelOnly"></div>

    <div class="form-group">
        <label>ID</label>
        <input class="form-control" type="text" asp-for="Product.Id" readonly>
    </div>

    <div class="form-group">
        <label>Title</label>
        <input class="form-control" type="text" required asp-for="Product.Title">
    </div>

    <div class="form-group">
        <label>Region</label>
        <input class="form-control" type="text" asp-for="Product.Region" readonly>
    </div>

    <div class="form-group">
        <label>Fish Rating</label>
        @{
            var rating = Enum.GetValues(typeof(ProductRating));
            var currentRating = (int)@Model.Product.Rating;

            foreach (int i in rating)
            {

                // Do not show the Unknown rating on the form
                if (i == 0)
                {
                    continue;
                }
                <div class="form-check">
                    @if (i == currentRating)
                    {
                        <input required asp-for="Product.Rating" type="radio" value="@i" checked>
                    }
                    else
                    {
                        <input required asp-for="Product.Rating" type="radio" value="@i">
                    }
                    <label class="form-check-label" for="gridRadios1">
                        @ProductModel.convertToString((ProductRating)i)
                    </label>
                </div>
            }
        }
        <span asp-validation-for="Product.Rating" class="text-danger"></span>
    </div>

    <div class="form-group">
        <label>Description</label>
        <textarea class="form-control" required asp-for="Product.Description"></textarea>
    </div>

    <div class="form-group">
        <label>Image</label>
        <input class="form-control" data-toggle="popover-hover" type="url" pattern="https://.*" size="30" required asp-for="Product.Image">
    </div>

    <input class="btn btn-primary" type="submit" id="Submit">
}

@section scripts{
    <script>
        $(document).ready(function () {
            $('[data-toggle="popover-hover"]').popover({
                html: true,
                trigger: 'hover',
                placement: 'bottom',
                content: function () {
                    if ($(this).val().match('^(?:[a-z]+:)?//'))
                        return '<img src="' + $(this).val() + '";/>';
                    return '<img src="' + $(this).val().replace(/^([^/])/, '/$1') + '";/>';
                }
            });
        });
    </script>
}